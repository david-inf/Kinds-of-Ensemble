---
title: "Heart disease dataset"
output: html_document
date: "2024-05-24"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
source("utils.R")

plots.dir <- "../plots/"
```


## Dataset

```{r}
heart <- read.csv("../data/heart.csv")

target <- 14
dataset.distrib(heart[,target])
```

- age
- sex
- chest pain type (4 values)
- resting blood pressure
- serum cholestoral in mg/dl
- fasting blood sugar > 120 mg/dl (true or false)
- resting electrocardiographic results (values 0,1,2)
- maximum heart rate achieved
- exercise induced angina (yes or no)
- oldpeak = ST depression induced by exercise relative to rest
- the slope of the peak exercise ST segment
- number of major vessels (0-3) colored by flourosopy
- thal: 0 = normal; 1 = fixed defect; 2 = reversable defect

```{r}
boxplot(scale(heart[,-target]))

summary(heart[,-target])
```

```{r}
IQR(scale(heart$age))
quantile(scale(heart$age), probs=c(0.25,0.75))
```

```{r}
boxplot.stats(scale(heart$chol))$out
```

```{r}
heatmap(cor(heart[,-target]), Colv=NA, Rowv=NA)
```


```{r}
n <- nrow(heart)

set.seed(111)
train.idx <- sample(n, n - floor(n / 3), replace=FALSE)

train <- heart[train.idx,]
test <- heart[-train.idx,]
```



## Clustering

```{r}
set.seed(111)
heart.clust <- kmeans(heart[,-target], 2, nstart=20)
```



## Logistic regression

```{r}
library(glmnet)
```

```{r}
logist <- glm(target ~ ., data=heart, family="binomial")

summary(logist)
first.metrics(2 * heart$target - 1, ifelse(logist$fitted.values > 0.5, 1, -1))
```

```{r}
logist.reg <- glmnet(as.matrix(heart[,-target]), heart[,target], family="binomial", alpha=0)
```

```{r}
plot(logist.reg, xvar="lambda")
legend("bottomright", legend=colnames(heart[,-target]), cex=0.8)
```


## Decision tree

```{r}
library(rpart)
library(rpart.plot)
```

```{r}
tree <- rpart::rpart(target ~ ., data=heart, method="class",
                     control=rpart.control(minsplit=10, cp=0))

tree2 <- rpart::rpart(target ~ ., data=heart, method="class",
                     control=rpart.control(minsplit=10, cp=0.01))

mincp <- tree$cptable[which.min(tree$cptable[,"xerror"]), "CP"]

tree.pr <- rpart::prune(tree, cp=mincp)
```

```{r}
first.metrics(train$Outcome, predict(tree, type="class"),
              test$Outcome, predict(tree, type="class", newdata=test), FALSE)

paste0("Terminal nodes: ", sum(tree$frame$var == "<leaf>"))
```

```{r}
## pruned tree
rpart.plot(tree.pr)
rpart.plot(tree2)
```




## Tree boosting
















